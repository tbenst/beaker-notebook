{
  "id": "/bunsen-staging",
  "apps": [
    {
      "id": "/bunsen-staging/web",
      "cmd": "",
      "cpus": 1,
      "mem": 512,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-web",
          "portMappings": [
            {
              "containerPort": 8081,
              "hostPort": 0,
              "servicePort": 8081,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "WEB_ROOT": "/var/www/public",
        "BAMBOO_HOST": "bunsen-staging.withmojo.com",
        "BAMBOO_ACLS": "!{ path_beg -i /api } !{ path_beg -i /beaker } !{ path_beg -i /events }"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-staging/api",
      "cmd": "",
      "cpus": 1,
      "mem": 512,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-api",
          "portMappings": [
            {
              "containerPort": 3000,
              "protocol": "tcp"
            }
          ]
        },
        "volumes": [
          {
            "hostPath": "/mnt/gluster0/bunsen-staging/repos",
            "containerPath": "/var/app/.repos",
            "mode": "RW"
          },
          {
            "hostPath": "/mnt/gluster0/bunsen-staging/scratch",
            "containerPath": "/mnt/gluster0/bunsen-staging/scratch",
            "mode": "RW"
          }
        ]
      },
      "env": {
        "NODE_ENV": "staging",
        "ALLOW_CROSS_ORIGIN": true,
        "EXTERNAL_DB_HOST": "bunsen-staging-db.cyuqbkun2hqi.us-east-1.rds.amazonaws.com",
        "EXTERNAL_DB_USER": "bunsen",
        "EXTERNAL_DB_PASS": "FSoq93X8KuyQN6333EV3411zf",
        "EXTERNAL_DB_NAME": "bunsen_staging",
        "HOSTNAME": "bunsen-staging.withmojo.com",
        "MANDRILL_PASSWORD":"-QG6MBSWNPR7sPwRali8Jg",
        "MANDRILL_USER":"ops+mandrill@mojotech.com",
        "MAIL_FROM": "ops+bunsen@mojotech.com",
        "ELASTICSEARCH_PORT_9200_TCP_ADDR": "bunsen:s6nFTwtbZP3wHh@172.17.42.1",
        "ELASTICSEARCH_PORT_9200_TCP_PORT": 9200,
        "PROVISIONER_PORT_3001_TCP_ADDR": "172.17.42.1",
        "PROVISIONER_PORT_3001_TCP_PORT": 3001,
        "SCRATCH_SPACE_ROOT": "/mnt/gluster0/bunsen-staging/scratch",
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "BAMBOO_HOST": "bunsen-staging.withmojo.com",
        "BAMBOO_PATH": "/api"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/api/status",
          "gracePeriodSeconds": 60,
          "intervalSeconds": 30,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-staging/provisioner",
      "cmd": "",
      "cpus": 1,
      "mem": 512,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-provisioner",
          "portMappings": [
            {
              "containerPort": 3001,
              "servicePort": 3001,
              "protocol": "tcp"
            }
          ]
        }
      },
      "ports": [
        3001
      ],
      "env": {
        "PROVISIONER_PORT": 3001,
        "PROVISIONER_LIFECYCLE_STRATEGY": "marathon",
        "BAMBOO_URL": "http://cluster-slave.withmojo.com:8000",
        "MARATHON_URL": "http://cluster-master.withmojo.com:8080",
        "APP_GROUP": "/bunsen-staging/beaker",
        "APP_DEFAULTS": {
          "container": {
            "type": "DOCKER",
            "docker": {
              "image": "quay.io/mojotech/bunsen-beaker",
              "network": "BRIDGE",
              "portMappings": [
                {
                  "containerPort": 8801
                }
              ]
            },
            "volumes": [
              {
                "hostPath": "/mnt/bunsen",
                "containerPath": "/var/s3",
                "mode": "RO"
              }
            ]
          },
          "uris": [
            "file:///etc/.dockercfg"
          ],
          "cpus": 1,
          "mem": 2048,
          "instances": 1
        },
        "SERVICE_HOST": "bunsen-staging.withmojo.com",
        "SERVICE_PATH": "/beaker"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/api/v1/status",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-staging/riemann",
      "cmd": "",
      "cpus": 1,
      "mem": 512,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-riemann",
          "portMappings": [
            {
              "containerPort": 5556,
              "servicePort": 5556
            }
          ]
        }
      },
      "env": {
        "LIBRATO_USER": "chris@mojotech.com",
        "LIBRATO_TOKEN": "f7dbfefb544dbe35dc0812590ff6eaeb0d8eda87c53e707b3d60a68f7f0f451b",
        "BAMBOO_HOST": "bunsen-staging.withmojo.com",
        "BAMBOO_PATH": "/events"
      },
      "healthChecks": [
        {
          "protocol": "TCP",
          "path": ".",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0.5
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    }
  ]
}
